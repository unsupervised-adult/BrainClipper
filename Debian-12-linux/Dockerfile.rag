# RAG Mode Dockerfile
FROM python:3.10-slim

# Install system dependencies (if needed for log processing)
RUN apt-get update && \
    apt-get install -y build-essential libxml2 libxslt1.1 libxslt1-dev && \
    rm -rf /var/lib/apt/lists/*

# Install Python dependencies
RUN pip install --no-cache-dir ollama python-evtx



# Copy RAG and conversion scripts
COPY app/rag.py /app/rag.py
COPY app/convert_mta.py /app/convert_mta.py
COPY app/convert_evtx.py /app/convert_evtx.py
COPY app/rag-entry.sh /app/rag-entry.sh
COPY app/rag_cli.py /app/rag_cli.py

WORKDIR /app

# Make entry script executable
RUN chmod +x rag-entry.sh

# Entrypoint: run shell script for RAG workflow and CLI
ENTRYPOINT ["sh", "-c", "/app/rag-entry.sh && python3 convert_evtx.py && python3 rag_cli.py"]
